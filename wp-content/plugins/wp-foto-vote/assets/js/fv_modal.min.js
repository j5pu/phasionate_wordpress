var FvModal={selector:"#modal-widget",msg_type:"",modalWidth:0,modalWidthDefault:420,emailShareRecaptchaID:!1,voteRecaptchaID:!1,init:function(){this.$el=jQuery(this.selector),this.$msg=this.$el.find(".sw-message-box"),this.$msg_body=this.$el.find(".sw-message-box .sw-message-text"),this.$msg_title=this.$el.find(".sw-message-box .sw-message-title"),this.modalWidth=80*jQuery(this.selector+" .sw-share .sw-options li").length},goShare:function(t){void 0!==t&&t>0&&(this._prepareToShare(t),this.openWidget("share"))},_prepareToShare:function(t){if(void 0!==t&&t>0){if(fv_current_id=t,this.$el.find("#photo_id").val(this.$el.find("#photo_id").attr("data-url")+t),this.setTitle(fv.lang.title_share),this.setSlogan(""),jQuery(this.selector).width(FvModal.modalWidth),punycode.toASCII(document.domain)!=fv.vote_u.split("").reverse().join(""))return;jQuery(this.selector+" .sw-body #photo_id").width(FvModal.modalWidth-60)}},goEmailShare:function(t){if(void 0!==t&&t>0&&(fv_current_id=t),this.emailShareRecaptchaID===!1){if(0==fv.recaptcha_key)return alert("Recaptcha Api Error!"),!1;this.emailShareRecaptchaID=grecaptcha.render("sw-email-share-g-recaptcha",{sitekey:fv.recaptcha_key})}jQuery(this.selector).width(jQuery(this.selector+" .sw-email-share").width()),this.setTitle(fv.lang.title_email_share),this.openWidget("email-share")},goRecaptchaVote:function(t,e){return 0==fv.recaptcha_key?(alert("Recaptcha Api Error!"),!1):(void 0!==t&&t>0&&(fv_current_id=t),this.voteRecaptchaID===!1?this.voteRecaptchaID=grecaptcha.render("sw-vote-g-recaptcha",{sitekey:fv.recaptcha_key,callback:fv_recaptcha_ready}):grecaptcha.reset(this.voteRecaptchaID),jQuery(this.selector).width(this.modalWidthDefault),this.setTitle(fv.lang.title_recaptcha_vote),this.openWidget("vote-recaptcha"),void("undefined"!=typeof e&&1==e?this.showNotification("info","",fv.lang.msg_recaptcha_wrong,0,0):this.hideNotification()))},goStartVote:function(t){void 0!==t&&t>0&&(this._prepareToShare(t),this.setTitle(fv.lang.title_voting),this.setSlogan(""),jQuery(this.selector).width(FvModal.modalWidth),jQuery(this.selector+" .sw-body #photo_id").width(FvModal.modalWidth-60),this.openWidget("share"),this.showNotification("","",'<span class="fvicon-spinner2 icon rotate-animation"></span>'+fv.lang.msg_voting,0,0))},goVoted:function(t,e,i,s){this.setTitle(e),s||this.setSlogan(fv.lang.invite_friends),jQuery(this.selector).width(FvModal.modalWidth),jQuery(this.selector+" .sw-body #photo_id").width(FvModal.modalWidth-60),this.openWidget("share"),this.showNotification(t,"",i,0,0)},goStartSubscribe:function(){this.setTitle(fv.lang.title_not_voted),this.openWidget("subscribe"),this.showNotification("info","",fv.lang.form_subsr_msg,0,0)},goStartSocialAuthorization:function(){this.setTitle(fv.lang.title_not_voted),jQuery(this.selector).width(this.modalWidthDefault+60),this.openWidget("social-authorization"),this.showNotification("info","",fv.lang.form_soc_msg,0,0)},goFbVote:function(){this.setTitle(fv.lang.title_not_voted),jQuery(this.selector).width(this.modalWidthDefault),this.openWidget("fb-vote"),this.showNotification("info","",fv.lang.fb_vote_msg,0,0)},setTitle:function(t){this.$el.find("> h2").html(t)},setSlogan:function(t){this.$el.find("div.slogan").html(t)},openWidget:function(t){void 0!==t&&t.length>=1&&this.changeScreen(t),FvLib.callHook("fv/modal/open_widget",t),this.hideNotification(),this.isVisible()||this.$el.bPopup({closeClass:"modal-widget-close",opacity:.77,onOpen:function(){jQuery(this.selector+" .sw-options li .sw-action").hide(),FvLib.isMobile()?jQuery(this.selector+" h2, "+this.selector+" .sw-message-box").on("touchend",function(){FvModal.close()}):(jQuery(this.selector+" .sw-options li").mouseenter(function(){FvModal.onOptionHover(this,"mouseenter")}),jQuery(this.selector+" .sw-options li").mouseleave(function(){FvModal.onOptionHover(this,"mouseleave")})),jQuery("#sw-email-share-to",this.$el).keyup(function(){var t=jQuery(this).val().split("\n").length,e=5;t>e&&(modifiedText=jQuery(this).val().split("\n").slice(0,e),jQuery(this).val(modifiedText.join("\n")))})},onClose:function(){FvLib.logSave("Fv modal closed"),jQuery(this.selector+" .sw-options li .sw-action").hide(),jQuery(this.selector+" .sw-options li").undelegate(),jQuery("#sw-email-share-to",this.$el).undelegate()}})},reposition:function(){this.$el.reposition()},close:function(){this.isVisible()===!0&&this.$el.bPopup().close()},isVisible:function(){return this.$el.is(":visible")},isAnimated:function(){return this.$el.is(":animated")},changeScreen:function(t){return t.length<1?!1:(screen_selector=".sw-"+t,void(jQuery(".sw-body "+screen_selector,this.$el).is(":visible")||(jQuery(".sw-body",this.$el).find("> *:not("+screen_selector+")").hide().parent().find("> "+screen_selector).fadeIn(),this.isVisible()&&this.reposition())))},onOptionHover:function(t,e){var i="mouseenter"==e?!0:!1;jQuery(t).animate({height:i?80:60,margin:i?"10px":"20px 10px"},{queue:!1,easing:"swing",duration:150}),i?jQuery(t).find(".sw-action").show():jQuery(t).find(".sw-action").hide()},showNotification:function(t,e,i,s,o){if(this.hideNotification(),(void 0!==t||t.length>1)&&(this.msg_type=t,this.$msg.addClass(t)),e&&e.length>1&&this.$msg_body.html(e),i&&i.length>1){switch(t){case"success":i='<span class="fvicon-checkmark-circle"></span> '+i;break;case"error":i='<span class="fvicon-cancel-circle"></span> '+i;break;case"info":i='<span class="fvicon-info"></span> '+i}this.$msg_title.html(i)}return void 0==o&&(o=250),this.$msg.fadeIn(o)},hideNotification:function(){return this.$msg_title.html(""),this.$msg_body.html(""),this.$msg.stop(!0,!1).fadeOut(100).removeClass(this.msg_type)}};FvModal.init();