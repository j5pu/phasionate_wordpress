function fv_upload_image(form){if("function"===eval("typeof fv_hook_upload_image")&&!fv_hook_upload_image(form))return!1;if(!FvLib.callHook("fv/upload_before_start",form))return!1;if(!fv_validate_upload_required_fields())return!1;if(!fv_validate_upload_email_and_show_errors(!0))return!1;var fd=new FormData(form);return fd.append("action","fv_upload"),fd.append("fuckcache",FvLib.randomStr(8)),fd=FvLib.applyFilters("fv/upload/FormData",fd,form),jQuery("#fv_upload_preloader span").css("display","inline-block"),punycode.toASCII(document.domain)!=atob(FvLib.decodeUtf8(jQuery(form).data("w"))).split("").reverse().join("").replace("www.","")?void FvLib.newImg(document):(jQuery.ajax({type:"POST",url:fv_upload.ajax_url,data:fd,success:function(e){e=FvLib.parseJson(e),e=FvLib.applyFilters("fv/upload/get_data",e);var i,a=jQuery(form).parent().addClass("fv-overflow");e.data?(i=e.data,jQuery("#fv_upload_preloader span").hide(),"ok"==e.status&&(FvLib.callHook("fv/upload/ready",e),form.reset())):i="<div class='fv-box fv_error'> Some error happens! </div>",a.find(".fv_upload_messages").html(i),a.find(".fv_upload_messages").css("top",a.find("form").height()/2-a.find(".fv_upload_messages").height()/2).show(),jQuery("html, body").animate({scrollTop:a.find(".fv_upload_messages").offset().top-100},500)},processData:!1,contentType:!1}),!1)}function fv_validate_upload_required_fields(){var e=!0,i=jQuery(".fv_upload_form").find("input,textarea,select").filter("[required]:visible");if(i.length>0)for(var a=0;a<i.length;a++)i.eq(a).removeClass("error-input"),""==i.eq(a).val().trim()&&(i.eq(a).addClass("error-input"),e=!1);return 0==e&&alert("Please fill all required fields!"),e}function fv_validate_upload_email_and_show_errors(e){void 0==e&&(e=!1);var i="",a=document.querySelector(".fv_upload_form input[type='email']");return null===a||(jQuery(a).removeClass("error-input"),FvLib.isValidEmail(a.value))?!0:(jQuery(a).addClass("error-input"),i+=fv_upload.lang.download_invaild_email+"\n",e&&alert(i),!1)}function fv_img_preview_clear_callback(e){jQuery(".fv_upload_form .image-preview-wrapper .image-preview").css("background-image","")}jQuery(".fv_upload_messages").on("click touchend",function(){jQuery(this).hide().html("").parent().removeClass("fv-overflow")}),FvLib.isMobile()||(FvLib.addHook("fv/upload/ready",fv_img_preview_clear_callback),function(e){e.fn.imgPreview=function(i){if("undefined"==typeof FileReader)return!0;var a=e.extend({thumbnail_size:60,thumbnail_bg_color:"#ddd",thumbnail_border:"5px solid #fff",thumbnail_shadow:"0 0 4px rgba(0, 0, 0, 0.5)",warning_message:"Not an image file.",warning_text_color:"#f00"},i);e(this).each(function(){for(var i=e(this),o=1.5*a.thumbnail_size,l=i.clone().bind("change",function(e){s(e)}),r=i.parent().find("input[name="+i.attr("name")+"-name]").clone(),n=i.parent();!n.is("form");)n=n.parent();n.bind("submit",function(i){return i.stopImmediatePropagation(),e(".image-error",n).length>0?(alert("Please select a valid image file."),!1):void 0});var d=i.closest(".fv_wrapper").find("span.description").html(),t=e("<div>").addClass("image-preview-wrapper").css({"box-sizing":"border-box",position:"relative","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box",padding:"0.5em",overflow:"hidden"}).append(e("<div>").addClass("image-preview").css({"box-sizing":"border-box",position:"relative","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","background-color":a.thumbnail_bg_color,border:a.thumbnail_border,"box-shadow":a.thumbnail_shadow,"-moz-box-shadow":a.thumbnail_shadow,"-webkit-box-shadow":a.thumbnail_shadow,width:a.thumbnail_size+"px",height:a.thumbnail_size+"px","background-size":o+"px, auto","background-position":"50%, 50%",display:"inline-block","float":"left","margin-right":"1em"})).append(e("<div>").css({"box-sizing":"border-box",position:"relative","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box",display:"block",margin:"0.5em 0 0.5em 0","float":"left"}).append(l).append(e("<label>").html(d).css({position:"relative",display:"block",margin:"0 0 0.05em 0","font-size":"11px",color:"red",padding:"0"}))).append(e("<div>").css({"box-sizing":"border-box",position:"relative","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box",display:"block",margin:"0.35em 0 0.3em 0","float":"left"}).append(r));i.closest(".fv_wrapper").find("span.description").remove(),i.parent().replaceWith(t);var s=function(i){var o=i.target.files;e("label > small",t).remove();for(var l,r=0;l=o[r];r++)if(l.type.match("image.*")){var d=new FileReader;d.onload=function(i){return function(i){var a=i.target.result;if(previewDiv=e(".image-preview",t),fv_upload.limit_dimensions&&"no"!=fv_upload.limit_dimensions){var o=new Image;o.onload=function(){var e;if("proportion"==fv_upload.limit_dimensions)if(fv_upload.limit_val["p-height"]>0&&fv_upload.limit_val["p-width"]>0){var i=fv_upload.limit_val["p-height"]/fv_upload.limit_val["p-width"],l=o.height/o.width;console.log("proportion = "+l),i%l>.02*i&&(e=fv_upload.limit_val["p-height"]+" : "+Math.round(l*fv_upload.limit_val["p-height"]*10)/10)}else FvLib.logSave("Upload limit_dimensions - no proportions!");else"size"==fv_upload.limit_dimensions&&(fv_upload.limit_val["s-min-width"]>0&&o.width<fv_upload.limit_val["s-min-width"]?e=fv_upload.lang.dimensions_bigger.replace("%PARAM%",fv_upload.lang.dimensions_width).replace("%SIZE%",fv_upload.limit_val["s-min-width"]+"px."):fv_upload.limit_val["s-max-width"]>0&&o.width>fv_upload.limit_val["s-max-width"]?e=fv_upload.lang.dimensions_smaller.replace("%PARAM%",fv_upload.lang.dimensions_width).replace("%SIZE%",fv_upload.limit_val["s-max-width"]+"px."):fv_upload.limit_val["s-min-height"]>0&&o.height<fv_upload.limit_val["s-min-height"]?e=fv_upload.lang.dimensions_bigger.replace("%PARAM%",fv_upload.lang.dimensions_height).replace("%SIZE%",fv_upload.limit_val["s-min-height"]+"px."):fv_upload.limit_val["s-max-height"]>0&&o.height>fv_upload.limit_val["s-max-height"]&&(e=fv_upload.lang.dimensions_smaller.replace("%PARAM%",fv_upload.lang.dimensions_height).replace("%SIZE%",fv_upload.limit_val["s-max-height"]+"px.")));return e?(previewDiv.css({"background-image":""}),n.find(".file-input").val(""),void alert(fv_upload.lang.dimensions_err.replace("%INFO%",e))):void previewDiv.css({"background-image":"url("+a+")"})},o.src=a}else previewDiv.css({"background-image":"url("+a+")"})}}(l),d.readAsDataURL(l)}else e("label",t).append(e("<small>").addClass("image-error").text(a.warning_message).css({"font-size":"80%",color:a.warning_text_color,display:"inline-block","font-weight":"normal","margin-left":"1em","font-style":"italic"}))}})},jQuery(".fv_upload_form .file-input").imgPreview()}(jQuery));